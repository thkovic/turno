<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Registro de Turnos</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 0;
    }

    .container {
      width: 95%;
      max-width: 900px;
      margin: 30px auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px #ccc;
    }

    h1 {
      text-align: center;
    }

    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin: 6px 0;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      margin-right: 5px;
    }

    button:hover {
      background-color: #0056b3;
    }

    #watchdog {
      position: fixed;
      top: 10px;
      right: 10px;
      background: #28a745;
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 14px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }

    th {
      background: #007bff;
      color: white;
    }

    #historico-container {
      display: none;
    }
  </style>
</head>
<body>

<div id="watchdog">游릭 Online</div>

<div class="container" id="login-container">
  <h1>Login</h1>
  <input type="text" id="matriculaLogin" placeholder="Digite sua matr칤cula">
  <button id="btnLogin">Entrar</button>
  <button id="btnHistorico">Hist칩rico</button>
</div>

<div class="container" id="registro-container" style="display:none;">
  <h1>Registro de Turno</h1>
  <input type="text" id="tipo" placeholder="Tipo">
  <input type="text" id="nome" placeholder="Nome">
  <input type="text" id="matricula" placeholder="Matr칤cula">
  <input type="date" id="data">
  <input type="text" id="equipamento" placeholder="Equipamento">
  <input type="text" id="acionamento" placeholder="Acionamento">
  <textarea id="problema" placeholder="Problema"></textarea>
  <textarea id="solucao" placeholder="Solu칞칚o"></textarea>
  <input type="text" id="encerramento" placeholder="Encerramento">
  <button id="btnRegistrar">Registrar</button>
</div>

<div class="container" id="historico-container">
  <h1>Hist칩rico de Registros</h1>
  <table>
    <thead>
      <tr>
        <th>Tipo</th>
        <th>Nome</th>
        <th>Matr칤cula</th>
        <th>Data</th>
        <th>Equipamento</th>
        <th>Acionamento</th>
        <th>Problema</th>
        <th>Solu칞칚o</th>
        <th>Encerramento</th>
        <th>Data/Hora Edi칞칚o</th>
        <th>Watchdog</th>
      </tr>
    </thead>
    <tbody id="tabelaHistorico"></tbody>
  </table>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwFS6gRrIGYeWFZ9KYjSaOMLfJd_TTsrZcLNGyvdb7R0RZBcXrQUlgLUdAjNr7B58o/exec";

document.getElementById("btnLogin").addEventListener("click", async () => {
  const matricula = document.getElementById("matriculaLogin").value.trim();
  if (!matricula) return alert("Digite sua matr칤cula!");

  const formData = new URLSearchParams();
  formData.append("acao", "login");
  formData.append("matricula", matricula);

  const res = await fetch(SCRIPT_URL, { method: "POST", body: formData });
  const data = await res.json();

  if (data.status === "ok") {
    alert("Login realizado!");
    document.getElementById("login-container").style.display = "none";
    document.getElementById("registro-container").style.display = "block";
    document.getElementById("matricula").value = matricula;
  } else {
    alert(data.message);
  }
});

document.getElementById("btnRegistrar").addEventListener("click", async () => {
  const campos = ["tipo", "nome", "matricula", "data", "equipamento", "acionamento", "problema", "solucao", "encerramento"];
  const formData = new URLSearchParams();
  formData.append("acao", "registrar");
  campos.forEach(id => formData.append(id, document.getElementById(id).value));

  const res = await fetch(SCRIPT_URL, { method: "POST", body: formData });
  const data = await res.json();

  if (data.status === "ok") {
    alert("Registro salvo!");
  } else {
    alert("Erro ao registrar: " + data.message);
  }
});

document.getElementById("btnHistorico").addEventListener("click", async () => {
  const formData = new URLSearchParams();
  formData.append("acao", "historico");

  const res = await fetch(SCRIPT_URL, { method: "POST", body: formData });
  const data = await res.json();

  const tbody = document.getElementById("tabelaHistorico");
  tbody.innerHTML = "";

  if (!Array.isArray(data)) {
    alert("Erro ao carregar hist칩rico.");
    return;
  }

  data.forEach(row => {
    const tr = document.createElement("tr");
    for (let i = 0; i < 11; i++) {
      const td = document.createElement("td");
      td.textContent = row[i] || "";
      tr.appendChild(td);
    }
    tbody.appendChild(tr);
  });

  document.getElementById("login-container").style.display = "none";
  document.getElementById("registro-container").style.display = "none";
  document.getElementById("historico-container").style.display = "block";
});
</script>
</body>
</html>
