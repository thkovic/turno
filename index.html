<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Sistema Passagem de Turno</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        button { padding: 10px; margin: 5px; background: #4CAF50; color: white; border: none; cursor: pointer; }
        #result { margin: 20px; padding: 15px; border: 1px solid #ddd; background: #f9f9f9; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>üîÑ Sistema Passagem de Turno</h1>
    
    <button onclick="testarConexao()">1. Testar Conex√£o</button>
    <button onclick="carregarHistorico()">2. Carregar Hist√≥rico</button>
    <button onclick="registrarTurno()">3. Registrar Turno de Teste</button>
    
    <div id="result">Clique em um bot√£o para come√ßar...</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwFS6gRrIGYeWFZ9KYjSaOMLfJd_TTsrZcLNGyvdb7R0RZBcXrQUlgLUdAjNr7B58o/exec";

async function fazerRequisicao(dados) {
    try {
        console.log("üì§ Enviando:", dados);
        const resposta = await fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(dados)
        });
        const resultado = await resposta.json();
        console.log("üì• Recebido:", resultado);
        return resultado;
    } catch (erro) {
        console.error("‚ùå Erro:", erro);
        throw erro;
    }
}

function mostrarResultado(mensagem, tipo = 'info') {
    const div = document.getElementById('result');
    div.innerHTML = `<div class="${tipo}">${mensagem}</div>`;
}

async function testarConexao() {
    try {
        mostrarResultado("üîó Testando conex√£o com o servidor...");
        const resposta = await fetch(SCRIPT_URL);
        const dados = await resposta.json();
        
        if (dados.status === "ok") {
            mostrarResultado(`‚úÖ <strong>Conex√£o estabelecida!</strong><br>
                Mensagem: ${dados.message}<br>
                Watchdog: ${dados.valor}<br>
                ID Planilha: ${dados.planilha_id || 'N/A'}<br>
                URL: ${dados.planilha_url || 'N/A'}`, 'success');
        } else {
            mostrarResultado(`‚ùå Erro: ${dados.message}`, 'error');
        }
    } catch (erro) {
        mostrarResultado(`‚ùå Falha na conex√£o: ${erro.message}`, 'error');
    }
}

async function carregarHistorico() {
    try {
        mostrarResultado("üìä Carregando hist√≥rico...");
        const resultado = await fazerRequisicao({ getHistory: true });
        
        if (Array.isArray(resultado)) {
            if (resultado.length === 0) {
                mostrarResultado("üì≠ Nenhum registro encontrado na planilha", 'info');
            } else {
                let html = `<strong>‚úÖ ${resultado.length} registros encontrados:</strong><br><br>`;
                resultado.forEach((reg, index) => {
                    html += `<strong>Registro ${index + 1}:</strong> ${JSON.stringify(reg)}<br>`;
                });
                mostrarResultado(html, 'success');
            }
        } else {
            mostrarResultado(`‚ùå Erro: ${JSON.stringify(resultado)}`, 'error');
        }
    } catch (erro) {
        mostrarResultado(`‚ùå Erro ao carregar hist√≥rico: ${erro.message}`, 'error');
    }
}

async function registrarTurno() {
    try {
        mostrarResultado("üìù Registrando turno de teste...");
        const resultado = await fazerRequisicao({
            equipamento: "EQUIP-TESTE-" + Date.now(),
            nome: "Usuario Teste",
            matricula: "TESTE123",
            acionamento: "08:00",
            problema: "Problema de teste autom√°tico",
            solucao: "Solu√ß√£o aplicada com sucesso",
            encerramento: "09:30"
        });
        
        if (resultado.success) {
            mostrarResultado(`‚úÖ ${resultado.message}`, 'success');
            // Atualizar hist√≥rico ap√≥s registrar
            setTimeout(carregarHistorico, 1000);
        } else {
            mostrarResultado(`‚ùå ${resultado.message}`, 'error');
        }
    } catch (erro) {
        mostrarResultado(`‚ùå Erro ao registrar: ${erro.message}`, 'error');
    }
}
</script>
</body>
</html>
